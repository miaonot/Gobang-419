import java.io.*;
import java.net.*;

class ServerNet {
	int port;
	int m,n,x,y;
	ServerSocket server;
	Socket client1,client2;
	InputStream DataIn;
	OutputStream DataOut;
	
	//设置端口
	public void setPort(int port) {
		this.port = port;
	}
	
	//设置与客户机连接
	public void connect () {
		try {
			server = new ServerSocket(port);
			client1 = server.accept();
			System.out.println("已经与其中一只客户机连接"+client1.getInetAddress().getHostName());
			client2 = server.accept();
			System.out.println("已经与其中一只客户机连接"+client1.getInetAddress().getHostName());
		} catch(IOException ioe) {
			ioe.printStackTrace();
		}
	}
	
	//client1传向client2
	public void  deliver1to2 () {
		try {
			DataIn = client1.getInputStream();
			DataOut = client2.getOutputStream();
			byte[] a = new byte[512];
			DataIn.read(a);
			DataOut.write(a);
			byte[] b = new byte[512];
			DataIn.read(b);
			DataOut.write(b);
		} catch(IOException ioe) {
			ioe.printStackTrace();
		}
	}
	
	//client2传向client1
	public void  deliver2to1 () {
		try {
			DataIn = client2.getInputStream();
			DataOut = client1.getOutputStream();
			byte[] a = new byte[512];
			DataIn.read(a);
			DataOut.write(a);
			byte[] b = new byte[512];
			DataIn.read(b);
			DataOut.write(b);
		} catch(IOException ioe) {
			ioe.printStackTrace();
		}
	}
	
	//关闭连接
	public void closeUp() {
		try {
			server.close();
		} catch(IOException ioe) {
			ioe.printStackTrace();
		}
	}
}

public class ServerGobang {
	public static void main(String[] args) {
		ServerNet test = new ServerNet();
		test.connect();
		try{
			while(true) {
				test.deliver1to2();
				test.deliver2to1();
		}
			
		} finally {
			test.closeUp();
		}
	}
}
